<!DOCTYPE html>

<html><head>
 <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.5, user-scalable=yes" />
 <title>Loading - Wilderness Ranger</title>
 <link rel="stylesheet" href="/web/main.min.css" />
 <link rel="stylesheet" href="/web/font/icons.css" />
 <script src="//cdn.jsdelivr.net/npm/prismjs@1.22/components/prism-core.min.js"></script>
 <script src="//cdn.jsdelivr.net/npm/prismjs@1.22/plugins/autoloader/prism-autoloader.min.js"></script>
 <link rel="stylesheet" href="/web/prism.css" />
</head><body>

<header id="banner">
 <h1>Wilderness<br />Ranger</h1>
 <p>Subsisting for now, coding for dreams, innovating forever.</p>
 <hr />
 <input type="text" class="banner-focus" placeholder="Search" />
 <div class="banner-background" style="background-image: url(/media/main/train-mountain.jpg);"></div>
</header>

<nav id="floater">
 <img class="floater-avatar" src="/web/avatar.png" /><a class="floater-header" href="/main">Wilderness Ranger</a>
 <button class="floater-menu icon" title="Settings">âš™</button><ul class="floater-cascade">
  <a class="icon-list" onclick="interact('M');">Markdown</a>
  <hr />
  <a class="icon-moon" onclick="interact('D');">Auto</a>
 </ul>
 <button class="floater-menu icon" title="Information">i</button><ul class="floater-cascade">
  <a href="https://github.com/WRtux/blog">Version 0.4</a>
 </ul>
</nav>

<main id="wrapper">
 <article id="marked">
  <!-- Dynamic -->
  <h2>Loading</h2>
  <p>Markdown reader by Wilderness Ranger. <noscript>To run Marked renderer, please enable JavaScript.</noscript></p>
 </article>
 <article id="recent">
  <h1>Recent</h1>
  <!-- Dynamic -->
 </article>
</main>

<script src="/web/marked.min.js"></script>

<script src="/web/main.min.js"></script>
<script type="text/javascript">"use strict";
var url = "/main.md";

function interact(act) {
	switch(act) {
	case "markdown":
	case 'M':
		window.open(url);
		break;
	case "dark":
	case 'D':
		switchDark();
		break;
	}
}

/*
(function () {
	renderDirect("marked", url);
	var lis = sortList(fetchList("/blog/").list);
	for (var i = lis.length - 1; i >= lis.length - 3 && i >= 0; i--) {
		var cont = document.createElement("article");
		renderAbstract(cont, fetchContent("/blog/" + lis[i]).content);
		cont.setClass("marked-abstract");
		cont.setAttribute("href", "/list/" + lis[i].slice(0, -3));
		cont.onclick = function () { location.assign(this.getAttribute("href")); };
		document.queryId("recent").appendChild(cont);
	}
})();
*/
void async function () {
	renderURL('marked', url);
	try {
		let li = await fetchArticleList('/blog/meta.xml');
		for (let en of li.slice(-3).reverse()) {
			let cont = document.createElement('article');
			cont.classList.add('marked-abstract');
			cont.setAttribute('href', '/list/' + en.fileName);
			cont.addEventListener('click', (e) => location.assign(e.currentTarget.getAttribute('href')));
			await renderURL(cont, '/blog/' + en.fileName, {abstract: true});
			document.getElementById('recent').appendChild(cont);
		}
	} catch (err) {
		document.getElementById('recent').appendChild(buildFailure(err));
	}
}();

</script>
</body></html>
